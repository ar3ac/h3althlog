{% extends 'base.html' %}
{% block content %}
<header class="month-header">
  <a class="btn" href="{{ url_for('main.month_view', y=prev[0], m=prev[1]) }}" class="month-prev">« Prec</a>
  <h1 class="month-title">{{ label }}</h1>
  <div class="month-actions">

    <a class="btn" href="{{ url_for('main.month_view', y=next[0], m=next[1]) }}" class="month-next">Succ »</a>
  </div>
</header>


<section class="month-grid">
  <div class="dow">Lun</div><div class="dow">Mar</div><div class="dow">Mer</div>
  <div class="dow">Gio</div><div class="dow">Ven</div><div class="dow">Sab</div><div class="dow">Dom</div>

{% for week in weeks %}
  {% for d in week %}
    {% set triple = entries.get(d) %}
    {% set b = triple[0] if triple else None %}
    {% set l = triple[1] if triple else None %}
    {% set c = triple[2] if triple else None %}

    {% set classes = ['day'] %}
    {% if d == today %}{% set _ = classes.append('day-today') %}{% endif %}
    {% if d.month != m %}{% set _ = classes.append('day-out') %}{% endif %}
    {% if triple %}{% set _ = classes.append('day-ok') %}{% else %}{% set _ = classes.append('day-empty') %}{% endif %}

    {# link diverso a seconda che esista o no l'entry #}
    {% set href = url_for('main.day_view', day=d.isoformat()) if triple
                 else url_for('entries.new_entry') + '?date=' + d.isoformat() %}

    <a class="{{ ' '.join(classes) }}" href="{{ href }}">
      <div class="day-hd">{{ d.day }}</div>
      <div class="day-pills">
        <span class="pill {{ 'q1' if b==1 else 'q2' if b==2 else 'q3' if b==3 else 'q0' }}" title="Colazione"></span>
        <span class="pill {{ 'q1' if l==1 else 'q2' if l==2 else 'q3' if l==3 else 'q0' }}" title="Pranzo"></span>
        <span class="pill {{ 'q1' if c==1 else 'q2' if c==2 else 'q3' if c==3 else 'q0' }}" title="Cena"></span>
      </div>
    </a>
  {% endfor %}
{% endfor %}


</section>
{% endblock %}
