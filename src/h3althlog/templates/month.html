{% extends 'base.html' %}
{% block content %}
<header class="month-header">
  <a href="{{ url_for('main.month_view', y=prev[0], m=prev[1]) }}" class="month-prev">Â«--</a>
  <h1 class="month-title">{{ label }}</h1>
  <a href="{{ url_for('main.month_view', y=next[0], m=next[1]) }}" class="month-next">--Â»</a>
</header>


<section class="month-grid">
  <div class="dow">Lun</div><div class="dow">Mar</div><div class="dow">Mer</div>
  <div class="dow">Gio</div><div class="dow">Ven</div><div class="dow">Sab</div><div class="dow">Dom</div>

{% for week in weeks %}
  {% for d in week %}
    {% set entry_data = entries.get(d) %}
    {% set b = entry_data[0] if entry_data else None %}
    {% set l = entry_data[1] if entry_data else None %}
    {% set c = entry_data[2] if entry_data else None %}
    {% set s = entry_data[3] if entry_data else None %}

    {% set classes = ['day'] %}
    {% if d == today %}{% set _ = classes.append('day-today') %}{% endif %}
    {% if d.month != m %}{% set _ = classes.append('day-out') %}{% endif %}
    {% if entry_data %}{% set _ = classes.append('day-ok') %}{% else %}{% set _ = classes.append('day-empty') %}{% endif %}

    {# link diverso a seconda che esista o no l'entry #}
    {% set href = url_for('main.day_view', day=d.isoformat()) if entry_data
                 else url_for('entries.new_entry', date=d.isoformat()) %}

    <a class="{{ ' '.join(classes) }}" href="{{ href }}">
      <div class="day-hd">{{ d.day }}</div>
      <div class="day-pills">
        <span class="pill q{{ b or 0 }}" title="Colazione"></span>
        <span class="pill q{{ l or 0 }}" title="Pranzo"></span>
        <span class="pill q{{ c or 0 }}" title="Cena"></span>
      </div>
      <div class="day-icons">
        {% if s is not none and s > 0 %}
          <span class="day-icon steps-icon" title="Passi: {{ s }}">ğŸ‘Ÿ</span>
        {% endif %}
      </div>
    </a>
  {% endfor %}
{% endfor %}


</section>
{% endblock %}
